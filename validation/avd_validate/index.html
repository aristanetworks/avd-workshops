
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../anta_validate/">
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38+insiders-4.53.13">
    
    
      
        <title>AVD Validate - Arista CI Workshops</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fd1ad6e4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.material.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#avd-validation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Arista CI Workshops" class="md-header__button md-logo" aria-label="Arista CI Workshops" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arista CI Workshops
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AVD Validate
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aristanetworks/avd-workshops" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Workshops on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Arista CI Workshops" class="md-nav__button md-logo" aria-label="Arista CI Workshops" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    Arista CI Workshops
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aristanetworks/avd-workshops" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Workshops on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Fundamentals
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Fundamentals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    VS Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jinja-yaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Jinja/YAML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Ansible
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Arista CI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Arista CI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    AVD L2LS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    AVD L2LS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../l2ls/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../l2ls/l2ls-lab-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Lab Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    AVD L3LS EVPN/VXLAN
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    AVD L3LS EVPN/VXLAN
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../l3ls/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../l3ls/l3ls-lab-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Lab Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cicd-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    CI/CD Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Automated Network Validation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Automated Network Validation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../anta_validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    ANTA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    
  
    AVD Validate
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    
  
    AVD Validate
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#review-of-anta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Review of ANTA
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-avd-validate-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1 - AVD Validate State
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-analyzing-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2 - Analyzing Results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-avd-validate-state-anta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3 - AVD Validate State (ANTA)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-day-2-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4 - Day 2 Validation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-avd-adjustments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5 - AVD Adjustments
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#review-of-anta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Review of ANTA
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-avd-validate-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1 - AVD Validate State
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-analyzing-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2 - Analyzing Results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-avd-validate-state-anta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3 - AVD Validate State (ANTA)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-day-2-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4 - Day 2 Validation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-avd-adjustments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5 - AVD Adjustments
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/aristanetworks/avd-workshops/blob/main/workshops/validation/avd_validate.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="avd-validation">AVD Validation<a class="headerlink" href="#avd-validation" title="Permanent link">&para;</a></h1>
<p>You should have completed the <a href="../anta_validate/">Getting Started with ANTA Validation</a> lab. If not, it's highly suggested that you complete that before continuing. This lab is intended to build on your understanding of ANTA and Arista Validated Designs (AVD) and give you the tools to test and validate a network fabric through automation.</p>
<p>While these are not hard requirements, these are the recommended prerequisites to gain the most from this lab:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Completed the <a href="../../git/">Automation Fundamentals Lab</a></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Completed either the <a href="../../l2ls/overview/">CI/AVD L2LS</a> or the <a href="../../l3ls/overview/">CI/AVD L3LS EVPN/VXLAN</a> labs</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Completed the <a href="../anta_validate/">Getting Started with ANTA Validation</a></li>
</ul>
<h2 id="review-of-anta">Review of ANTA<a class="headerlink" href="#review-of-anta" title="Permanent link">&para;</a></h2>
<p>At this point, we've explored the <a href="https://anta.arista.com">ANTA Framework</a> and the capabilities to test our network fabric. You should also be somewhat familiar with the AVD constructs, it has been used to deploy this lab if you are coming from the <a href="../anta_validate/">Getting Start with ANTA Validation</a>. So what does AVD and ANTA have to do with each other and how does this work.</p>
<p>Reminder, we are operating within the <code>labs/NET_TESTING/</code> directory for this lab, please change to this directory if you haven't already</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>~/project/labfiles/ci-workshops-avd/labs/NET_TESTING
</code></pre></div>
<h2 id="step-1-avd-validate-state">Step 1 - AVD Validate State<a class="headerlink" href="#step-1-avd-validate-state" title="Permanent link">&para;</a></h2>
<p>Before we dive into ANTA, lets look at AVD <a href="https://avd.sh/en/stable/roles/eos_validate_state/index.html">validate state</a> module called <code>eos_validate_state</code>.</p>
<ol>
<li>Lets look at the validation playbook in <code>playbooks/validate.yml</code></li>
<li>
<p>This playbook used the AVD <code>eos_validate_state</code> module; click the annotations below to discover what the critical lines do:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nn">---</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Validate Network State</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="hll"><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">target_hosts</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"> </span><span class="c1">#(1)!</span>
</span><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpapi</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validate states on EOS devices</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">      </span><span class="nt">ansible.builtin.import_role</span><span class="p">:</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="hll"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arista.avd.eos_validate_state</span><span class="w"> </span><span class="c1">#(2)!</span>
</span></code></pre></div>
<ol>
<li>We will pass the <code>SITE1_FABRIC</code> as an extra variable to tell this playbook to validate SITE 1</li>
<li>Here we import the role <code>eos_validate_state</code> which will run validations based on the AVD data models</li>
</ol>
</li>
<li>
<p>Before we run this, lets summarize what this role is performing</p>
<ol>
<li>First, this role requires an AVD build to have been completed. Those intended configurations generated within <code>sites/site_1/intended/</code> are used to understand what to validate</li>
<li>Second, the role will rely heavily on Ansible to gather device details and validate the device state is healthy based on AVD</li>
</ol>
</li>
<li>
<p>Ok, lets run this playbook, we can use the <code>make</code> shortcut</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>make<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>So a lot happened! If you look at the Ansible play recap, we see there are a number of tests it performs</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Wednesday<span class="w"> </span><span class="m">04</span><span class="w"> </span>September<span class="w"> </span><span class="m">2024</span><span class="w">  </span><span class="m">19</span>:43:14<span class="w"> </span>+0000<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:00.964<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:38.051<span class="w"> </span>***
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="o">===============================================================================</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>eos_validate_state<span class="w"> </span>-----------------------------------------------------<span class="w"> </span><span class="m">37</span>.93s
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>total<span class="w"> </span>------------------------------------------------------------------<span class="w"> </span><span class="m">37</span>.93s
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>Wednesday<span class="w"> </span><span class="m">04</span><span class="w"> </span>September<span class="w"> </span><span class="m">2024</span><span class="w">  </span><span class="m">19</span>:43:14<span class="w"> </span>+0000<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:00.964<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:38.051<span class="w"> </span>***
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="o">===============================================================================</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>ip<span class="w"> </span>reachability<span class="w"> </span>state<span class="w"> </span>between<span class="w"> </span>devices<span class="w"> </span><span class="o">(</span>loopback0<span class="w"> </span>&lt;-&gt;<span class="w"> </span>loopback0<span class="o">)</span><span class="w"> </span>-----------------<span class="w"> </span><span class="m">6</span>.09s
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Run<span class="w"> </span>show<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>lo0<span class="w"> </span>------------------------------------------------------------------<span class="w"> </span><span class="m">5</span>.67s
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>ip<span class="w"> </span>reachability<span class="w"> </span>state<span class="w"> </span><span class="o">(</span>directly<span class="w"> </span>connected<span class="w"> </span>interfaces<span class="o">)</span><span class="w"> </span>---------------------------<span class="w"> </span><span class="m">4</span>.63s
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Run<span class="w"> </span>show<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>VTEP<span class="w"> </span>IP<span class="w"> </span>--------------------------------------------------------------<span class="w"> </span><span class="m">2</span>.20s
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Create<span class="w"> </span>required<span class="w"> </span>output<span class="w"> </span>directories<span class="w"> </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>present<span class="w"> </span>--------------------------------------<span class="w"> </span><span class="m">1</span>.38s
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>EOS<span class="w"> </span>platform<span class="w"> </span>and<span class="w"> </span>version<span class="w"> </span>details<span class="w"> </span>------------------------------------------------<span class="w"> </span><span class="m">1</span>.26s
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Create<span class="w"> </span>Validation<span class="w"> </span>report<span class="w"> </span>-<span class="w"> </span>Markdown<span class="w"> </span>----------------------------------------------------<span class="w"> </span><span class="m">0</span>.96s
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>bgp<span class="w"> </span>summary<span class="w"> </span><span class="o">(</span>ip<span class="w"> </span>and<span class="w"> </span>evpn<span class="o">)</span><span class="w"> </span>-------------------------------------------------------<span class="w"> </span><span class="m">0</span>.95s
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Generate<span class="w"> </span>variables<span class="w"> </span><span class="k">for</span><span class="w"> </span>testing<span class="w"> </span>---------------------------------------------------------<span class="w"> </span><span class="m">0</span>.93s
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Create<span class="w"> </span>Validation<span class="w"> </span>report<span class="w"> </span>-<span class="w"> </span>CSV<span class="w"> </span>---------------------------------------------------------<span class="w"> </span><span class="m">0</span>.90s
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>ntp<span class="w"> </span>status<span class="w"> </span>----------------------------------------------------------------------<span class="w"> </span><span class="m">0</span>.89s
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>mlag<span class="w"> </span>status<span class="w"> </span>---------------------------------------------------------------------<span class="w"> </span><span class="m">0</span>.87s
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>summary<span class="w"> </span>and<span class="w"> </span>ArBGP<span class="w"> </span>state<span class="w"> </span>------------------------------------------------<span class="w"> </span><span class="m">0</span>.86s
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>lldp<span class="w"> </span>topology<span class="w"> </span>-------------------------------------------------------------------<span class="w"> </span><span class="m">0</span>.83s
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Gather<span class="w"> </span>interfaces<span class="w"> </span>state<span class="w"> </span>----------------------------------------------------------------<span class="w"> </span><span class="m">0</span>.83s
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Generate<span class="w"> </span>Results<span class="w"> </span><span class="o">(</span>Set<span class="w"> </span>eos_validate_state_report<span class="o">)</span><span class="w"> </span>---------------------------------------<span class="w"> </span><span class="m">0</span>.73s
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Validate<span class="w"> </span>ip<span class="w"> </span>bgp<span class="w"> </span>neighbors<span class="w"> </span>peer<span class="w"> </span>state<span class="w"> </span>---------------------------------------------------<span class="w"> </span><span class="m">0</span>.33s
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Validate<span class="w"> </span>bgp<span class="w"> </span>evpn<span class="w"> </span>neighbors<span class="w"> </span>peer<span class="w"> </span>state<span class="w"> </span>-------------------------------------------------<span class="w"> </span><span class="m">0</span>.33s
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Validate<span class="w"> </span>loopback<span class="w"> </span>reachability<span class="w"> </span>---------------------------------------------------------<span class="w"> </span><span class="m">0</span>.30s
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Validate<span class="w"> </span>lldp<span class="w"> </span>topology<span class="w"> </span>when<span class="w"> </span>there<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>domain<span class="w"> </span>name<span class="w"> </span>-------------------------------------<span class="w"> </span><span class="m">0</span>.30s
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>Playbook<span class="w"> </span>run<span class="w"> </span>took<span class="w"> </span><span class="m">0</span><span class="w"> </span>days,<span class="w"> </span><span class="m">0</span><span class="w"> </span>hours,<span class="w"> </span><span class="m">0</span><span class="w"> </span>minutes,<span class="w"> </span><span class="m">38</span><span class="w"> </span>seconds
</code></pre></div>
</li>
<li>
<p>The play recap is great, but this role produces a report as a part of the run. This report details all tests that succeeded or failed.</p>
</li>
<li>
<p>Before we dig into the reports, run the validation against <code>site2</code> as well.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>make<span class="w"> </span>validate-site-2
</code></pre></div>
</li>
</ol>
<h2 id="step-2-analyzing-results">Step 2 - Analyzing Results<a class="headerlink" href="#step-2-analyzing-results" title="Permanent link">&para;</a></h2>
<p>Ok, we have run validation, what just happened?! So remember:</p>
<ol>
<li>The AVD data models in this lab have described how you <strong>intend</strong> to configure this network, from physical connectivity to protocols used.</li>
<li>AVD Validate state generated tests based on what it understands from an AVD build of the topology and configuration to generate tests</li>
</ol>
<p>YES, AVD just generated tests for you, lets take a look!</p>
<ol>
<li>
<p>Open <code>sites/site_1/reports/SITE1_FABRIC-state.md</code> and take a look at what the first part of this report shows</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Validation Report</label><label for="__tabbed_1_2">Validation Report Failures</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a class="glightbox" href="../assets/images/avd_report_ansible.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="AVD Validate State Report" src="../assets/images/avd_report_ansible.png" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../assets/images/avd_report_ansible_markup.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="AVD Validate State Report Failures" src="../assets/images/avd_report_ansible_markup.png" /></a></p>
</div>
</div>
</div>
</li>
<li>
<p>So first off note it generated over <strong>300+ tests</strong> for a single 8 node site!</p>
</li>
<li>If you haven't already, click the "Validation Report Failures" tab above, we can note a few things here<ol>
<li>Quickly we realize there are test failures in the <strong>Summary Totals</strong></li>
<li>In the device summary, we can quickly discern that we have failures on the <code>s1-brdr1</code> and both <code>spine</code> devices. The categories even give us hints as to what might be wrong here.</li>
<li>Last we the tests grouped by category, verifying what we seeing failing in our environment: LLDP issues + BGP issues = IP Reachability <img alt="🤔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f914.svg" title=":thinking:" /></li>
</ol>
</li>
<li>We could analyze more of this report, but first, <strong>let's run this report again using ANTA</strong>!</li>
</ol>
<h2 id="step-3-avd-validate-state-anta">Step 3 - AVD Validate State (ANTA)<a class="headerlink" href="#step-3-avd-validate-state-anta" title="Permanent link">&para;</a></h2>
<p>Ok, we just ran AVD validate state, we have produced a report, and looks like we've identified an issue already. Validate state heavily relies on Ansible modules (like the <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/assert_module.html">assert module</a>) and while it works great, it can prove challenging to maintain performance while trying to achieve more complex and larger scale testing.</p>
<div class="admonition tip">
<p class="admonition-title">AVD 5.0.0+</p>
<p>Moving forward, AVD 5.0.0 and beyond will use ANTA as it's default testing framework. ANTA is developed in python and gives AVD the ability to scale while maintaining performance as testing catalogs grow.</p>
</div>
<p>Let's go ahead and enable ANTA and see it in action:</p>
<ol>
<li>Open your validation playbook <code>playbooks/validate.yml</code></li>
<li>
<p>Uncomment the <code>vars</code> below, we will enable ANTA and instruct the role to save the generated test catalogs</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validate states on EOS devices</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nt">ansible.builtin.import_role</span><span class="p">:</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arista.avd.eos_validate_state</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="nt">use_anta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nt">save_catalog</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="nt">eos_validate_state_md_report_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">eos_validate_state_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">fabric_name</span><span class="nv"> </span><span class="s">}}-state-anta.md&quot;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">ANTA Report</p>
<p>We are saving the report to a new file, that way you can go back and review the differences between the two reports!</p>
</div>
</li>
<li>
<p>Make sure the file is saved and run our validation again</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>make<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>Ok, you may have noticed this play was not nearly as verbose in output, and it ran much faster! These runs were done for the creation of this lab (as of AVD 4.10.0) ANTA was over <strong>30 seconds faster.</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>Wednesday<span class="w"> </span><span class="m">04</span><span class="w"> </span>September<span class="w"> </span><span class="m">2024</span><span class="w">  </span><span class="m">20</span>:10:08<span class="w"> </span>+0000<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:00.168<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:06.034<span class="w"> </span>***
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="o">===============================================================================</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>eos_validate_state<span class="w"> </span>------------------------------------------------------<span class="w"> </span><span class="m">5</span>.93s
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>total<span class="w"> </span>-------------------------------------------------------------------<span class="w"> </span><span class="m">5</span>.93s
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>Wednesday<span class="w"> </span><span class="m">04</span><span class="w"> </span>September<span class="w"> </span><span class="m">2024</span><span class="w">  </span><span class="m">20</span>:10:08<span class="w"> </span>+0000<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:00.168<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:06.034<span class="w"> </span>***
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="o">===============================================================================</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Run<span class="w"> </span>eos_validate_state_runner<span class="w"> </span>leveraging<span class="w"> </span>ANTA<span class="w"> </span>------------------------------------------<span class="w"> </span><span class="m">3</span>.47s
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Create<span class="w"> </span>required<span class="w"> </span>output<span class="w"> </span>directories<span class="w"> </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>present<span class="w"> </span>--------------------------------------<span class="w"> </span><span class="m">1</span>.21s
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Include<span class="w"> </span>ANTA<span class="w"> </span>tasks<span class="w"> </span>---------------------------------------------------------------------<span class="w"> </span><span class="m">0</span>.67s
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Include<span class="w"> </span>Ansible<span class="w"> </span>assert<span class="w"> </span>tests<span class="w"> </span>report<span class="w"> </span>tasks<span class="w"> </span>----------------------------------------------<span class="w"> </span><span class="m">0</span>.17s
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Include<span class="w"> </span>device<span class="w"> </span>intended<span class="w"> </span>structured<span class="w"> </span>configuration<span class="w"> </span>variables<span class="w"> </span>-----------------------------<span class="w"> </span><span class="m">0</span>.13s
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Include<span class="w"> </span>Ansible<span class="w"> </span>assert<span class="w"> </span>tests<span class="w"> </span>-----------------------------------------------------------<span class="w"> </span><span class="m">0</span>.11s
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Create<span class="w"> </span>validation<span class="w"> </span>reports<span class="w"> </span>from<span class="w"> </span>ANTA<span class="w"> </span>tests<span class="w"> </span>----------------------------------------------<span class="w"> </span><span class="m">0</span>.09s
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>arista.avd.eos_validate_state<span class="w"> </span>:<span class="w"> </span>Verify<span class="w"> </span>Requirements<span class="w"> </span>--------------------------------------------------------------------<span class="w"> </span><span class="m">0</span>.08s
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>Playbook<span class="w"> </span>run<span class="w"> </span>took<span class="w"> </span><span class="m">0</span><span class="w"> </span>days,<span class="w"> </span><span class="m">0</span><span class="w"> </span>hours,<span class="w"> </span><span class="m">0</span><span class="w"> </span>minutes,<span class="w"> </span><span class="m">6</span><span class="w"> </span>seconds
</code></pre></div>
</li>
<li>
<p>Remember creating an ANTA test catalog in the ANTA lab, well we enabled <code>save_catalog</code>, AVD generated and saved that catalog for you to look at! It creates a catalog per device under the <code>sites/site_1/intended/test_catalogs/</code> directory.</p>
<div class="admonition tip">
<p class="admonition-title">That's a large catalog!</p>
<p>AVD generated over 2700 lines of test catalog configuration for you! If you look closely, many of those tests are specific peer to peer connectivity or neighborship tests.</p>
</div>
</li>
<li>
<p>Let's open the new ANTA report, remember we changed the name for this report, it should be <code>sites/site_1/reports/SITE1_FABRIC-state-anta.md</code></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Validation Report</label><label for="__tabbed_2_2">Validation Report Failures</label><label for="__tabbed_2_3">Old Validation Report Failures</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a class="glightbox" href="../assets/images/avd_report_anta.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="AVD Validate State Report" src="../assets/images/avd_report_anta.png" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../assets/images/avd_report_anta_markup.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="AVD Validate State Report Failures" src="../assets/images/avd_report_anta_markup.png" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../assets/images/avd_report_ansible_markup.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Old AVD Validate State Report Failures" src="../assets/images/avd_report_ansible_markup.png" /></a></p>
</div>
</div>
</div>
</li>
<li>
<p>Click the "Validation Report Failures" tab above, we can see we get very similar summaries of the failures. We note we still have an issue with <code>s1-brdr1</code> and both <code>spine</code> devices. One key difference is the test categories, but it still points us to a BGP/Connectivity issue!</p>
</li>
<li>If you haven't already, you can compare the failure results of the two reports by clicking the "Old Validation Report Failures" above.</li>
<li>
<p>Let's review the section called "Failed Test Results Summary," we get a list of all failed tests with a bit more verbosity
    <a class="glightbox" href="../assets/images/avd_report_failure_summary.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="AVD Validate State Report" src="../assets/images/avd_report_failure_summary.png" /></a></p>
</li>
<li>
<p>There seems to be three tests within the <strong>BGP</strong> and <strong>Connectivity</strong> ANTA test categories failing</p>
<ol>
<li><code>VerifyBGPSpecificPeers</code></li>
<li><code>VerifyReachability</code></li>
<li><code>VerifyLLDPNeighbors</code></li>
</ol>
</li>
<li>
<p>Let's start with layer 1 and look at this <code>VerifyLLDPNeighbors</code> test failure, lets focus on the <strong>Inputs</strong> and <strong>Messages</strong>
        1.  Inputs (Intended): this is what AVD told the test framework what our fabric SHOULD look like, this is supposed to be source of truth
        2.  Messages (Actual): what ANTA has told AVD ACTUALLY exists in the network by querying the device</p>
</li>
<li>
<p>So that being said, looks like <code>s1-brdr1:Ethernet2</code> should be connected to <code>s1-spine1:Ethernet6</code>, but it detected it's actually detected <code>s1-spine1:Ethernet7</code>. Remember AVD would have configured <code>s1-spine1:Ethernet6</code> for peer connectivity, something isn't right.</p>
</li>
<li>
<p>Looks like we have one of two scenarios
        1. <strong>AVD Typo:</strong> We have a typo in what we consider our intended configuration in AVD
        2. <strong>Cabling Issue:</strong> We've cabled the links between <code>s1-brdr1</code> and our <code>spine</code> devices wrong</p>
</li>
<li>
<p>In a real-world scenario, this would have caught a use case of the links being transposed or a typo in the AVD repository! This is a virtual lab, so mistakes in cabling are most likely not the cause. Let's go fix AVD <img alt="😄" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f604.svg" title=":smile:" /></p>
</li>
<li>
<p>Under <code>sites/site_1/group_vars/SITE1_FABRIC.yml</code> let's fix our border node <code>s1-brdr1</code> up link interfaces, update the <code>uplink_switch_inerfaces</code> key.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w">  </span><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s1-brdr1</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">      </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">      </span><span class="nt">mgmt_ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.100/24</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="hll"><span class="w">      </span><span class="nt">uplink_switch_interfaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">Ethernet6</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Ethernet6</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1">#(1)!</span>
</span><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">      </span><span class="nt">evpn_gateway</span><span class="p">:</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">        </span><span class="nt">remote_peers</span><span class="p">:</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s2-brdr1</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">            </span><span class="nt">bgp_as</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65203</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">            </span><span class="nt">ip_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.250.2.7</span>
</code></pre></div>
<ol>
<li>Update this to <code>Ethernet7</code>, we are going to trust the border is cabled correctly and we just made a mistake here.</li>
<li>Ok, we're updated. We need to push this change into our environment now. Let's do that!</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>make<span class="w"> </span>build-site-1<span class="w"> </span>deploy-site-1
</code></pre></div>
</li>
<li>
<p>Perfect, give it a second for things to converge and let's try to validate! We should expect our validation to verify this peering is healthy now that we've fixed the layer 1 mix up 👍</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>make<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>CONGRATS! You've now validated the fabric, caught an issue, resolved it, and run over 1000 tests in this time with a click of a button (or several 😀)</p>
</li>
</ol>
<h2 id="step-4-day-2-validation">Step 4 - Day 2 Validation<a class="headerlink" href="#step-4-day-2-validation" title="Permanent link">&para;</a></h2>
<p>Well you've come a long way at this point, AVD is now generating all our tests for us and we can validate our fabric with a single playbook, A SINGLE TASK! That's great, we have confidence now, but we always want more testing! Let's dive into adding new tests to our environment and how AVD behaves with what we'll consider Day 2 Changes.</p>
<h3 id="day-2-dynamic-tests">Day 2 - Dynamic Tests<a class="headerlink" href="#day-2-dynamic-tests" title="Permanent link">&para;</a></h3>
<p>The first scenario we'll address is simply adding a VLAN. Adding VLANs/SVIs across a fabric can be automated, as you've seen with AVD, but ensuring that all those leaf switches take the change and/or that VLAN is actually up is another story. Let's try this out:</p>
<ol>
<li>Let's navigate to <code>sites/site_1/group_vars/SITE1_NETWORK_SERVICES.yml</code></li>
<li>Go ahead and uncomment VLAN 30; this will add the VLAN to the EVPN/VXLAN environment. That means each leaf should get this new VLAN/SVI</li>
<li>
<p>First, let's validate our network is still healthy; validation is great after a change, but it's just as important before a change!</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>make<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>Great, we shouldn't see any changes.</p>
</li>
<li>
<p>Lets run our AVD build only and validate</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>make<span class="w"> </span>build-site-1<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>Let's check our validation report <code>sites/site_1/reports/SITE1_FABRIC-state-anta.md</code></p>
</li>
<li>
<p>There's a new test for VLAN 30! Yes, AVD generated a test for you based on your AVD change. Yes, it failed because we told our validation to make sure the network has VLAN 30 configured and up... well we haven't deployed yet!</p>
<p><a class="glightbox" href="../assets/images/validate_vlan_failure.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="AVD Validate Vlan Failure" src="../assets/images/validate_vlan_failure.png" /></a></p>
</li>
<li>
<p>Let's fix that, let's deploy the changes and re-run our validation</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>make<span class="w"> </span>deploy-site-1<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>Awesome, you changed 4 lines of configuration and look at that testing at work for day 2 operations!</p>
</li>
</ol>
<h3 id="day-2-add-tests">Day 2 - Add Tests<a class="headerlink" href="#day-2-add-tests" title="Permanent link">&para;</a></h3>
<p>Ok, lets take a new scenario that we've got an ask from our enterprise monitoring and compliance teams to add a new logging server to our environment. Compliance would like us to prove all our switches are pointed to this logging server and are using the Management interface.</p>
<p>Great, let's solve this:</p>
<ol>
<li>First, let's take our first action, add the new logging server to the fabric</li>
<li>Open <code>sites/global_vars/global_dc_vars.yml</code> and uncomment the logging server. We are using global vars to enable the logging server globally, across both SITE1 and SITE2</li>
<li>
<p>Ok, like before, let's build and validate</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>make<span class="w"> </span>build-site-1<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>Let's check our validation report <code>sites/site_1/reports/SITE1_FABRIC-state-anta.md</code></p>
</li>
<li>
<p>Interesting, we don't see a new test like we did with Vlan 30. We would expect a failure based on the fact we defined a new logging server but haven't deployed it yet. Let's fix this</p>
<div class="admonition tip">
<p class="admonition-title">AVD and ANTA Tests</p>
<p>It's fair to have maybe expected a test and if you check the <a href="https://anta.arista.com/stable/api/tests.logging/">ANTA Documentation</a> there is a number of logging tests available! AVD is always introducing new AVD tests that can be generated based on structured configuration. You can always search open feature requests (or open your own) on the AVD repository to see if it's been requested or staged for the next release!</p>
<p>While it's not generated, we can still add it!</p>
</div>
</li>
<li>
<p>Let's fix this lack of test, we're going to leverage an AVD construct to provide our own tests.</p>
</li>
<li>Navigate to <code>sites/site_1/custom_anta_catalogs/SITE1_FABRIC.yml</code> and let's look at the contents here</li>
<li>This directory is where you can place files to add additional tests to your existing generated tests. The file names themselves behave the same way <code>group_vars</code> files behave; the file name maps to an ansible inventory group, and those tests in that file will be run against those devices. In this case, <code>SITE1_FABRIC.yml</code> is used, so every device in the fabric will get this test!</li>
<li>
<p>Uncomment the logging tests for now and let's re-run our validation</p>
<div class="admonition tip">
<p class="admonition-title">No AVD Build?</p>
<p>We haven't changed anything that changes configuration, simply adding tests, so no need to build again!</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>make<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>Ok, now we're seeing the failures, because we have not deployed the logging servers to our switches just yet. However, we know we have the test now.</p>
<p><a class="glightbox" href="../assets/images/validate_logging_failure.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="AVD Validate Logging Failure" src="../assets/images/validate_logging_failure.png" /></a></p>
</li>
<li>
<p>Let's deploy and validate again!</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>make<span class="w"> </span>deploy-site-1<span class="w"> </span>validate-site-1
</code></pre></div>
</li>
<li>
<p>Awesome, you should no longer see any failures, we deployed the change and our test validated our entire SITE1 fabric is configured correctly. We can hand this automation and report to prove we've configured logging servers correctly!</p>
</li>
</ol>
<h3 id="day-2-leaf-tests">Day 2 - Leaf Tests<a class="headerlink" href="#day-2-leaf-tests" title="Permanent link">&para;</a></h3>
<p>You've successfully added tests to prove global changes, but what if you want to target some tests for possible areas of interest. Management understand our <strong>spines are serving as route reflectors</strong> for our entire EVPN/VXLAN fabric and there is growing concern this could result in an outage. How might we address this?</p>
<p>Well let's see what we can do to build some confidence we're not only monitoring this, but ensuring that before any change to the spines they are healthy.</p>
<div class="admonition tip">
<p class="admonition-title">Monitoring should have caught this</p>
<p>As we go through this, of course monitoring should catch the tests we're about to present. We are simply double checking nothing was missed and of course ANTA can do some unique checks that aren't always caught in logs or traps!</p>
</div>
<ol>
<li>
<p>Before we begin, let's run our validation and check our report on the number of total tests per device</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>make<span class="w"> </span>validate-site-1
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>cat<span class="w"> </span>sites/site_1/reports/SITE1_FABRIC-state-anta.md<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-EA<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="s2">&quot;Summary.*Under Test&quot;</span>
</code></pre></div>
</li>
<li>
<p>Take note of the number of spine tests, we should see 3 additional tests during our next run</p>
</li>
<li>Let's navigate back to our custom ANTA catalog and open the <code>SITE1_SPINES.yml</code> file</li>
<li>In there, we have several system tests we can uncomment</li>
<li>We can add these to ONLY the spines to ensure their role as a route server hasn't caused any adverse effects. Critically we want to know before and after a change if anything changes here</li>
<li>
<p>Let's go ahead and run our new tests</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>make<span class="w"> </span>validate-site-1
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>cat<span class="w"> </span>sites/site_1/reports/SITE1_FABRIC-state-anta.md<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-EA<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="s2">&quot;Summary.*Under Test&quot;</span>
</code></pre></div>
</li>
<li>
<p>Great! You've added tests to only the spines; you may even see your tests catch the virtual environment running high on CPU and Memory! That's what Management wants to avoid 😄</p>
</li>
</ol>
<h2 id="step-5-avd-adjustments">Step 5 - AVD Adjustments<a class="headerlink" href="#step-5-avd-adjustments" title="Permanent link">&para;</a></h2>
<p>Last thing we're going to do is explore some options available to us and documented within the <a href="https://avd.sh/en/stable/roles/eos_validate_state/anta_integration.html#input-variables">AVD Validation Documentation</a>.</p>
<p>We are not going to go too deep into this topic, however it's important to note you can customize aspects of the validation framework, it can be molded to your operational workflows and needs.</p>
<h3 id="skip-tests">Skip Tests<a class="headerlink" href="#skip-tests" title="Permanent link">&para;</a></h3>
<p>Let's explore a use case where you need to pull specific tests out of a report to deliver to Management. For example, they are uninterested in test results related to hardware. You can skip the <a href="https://avd.sh/en/stable/roles/eos_validate_state/anta_integration.html#test-categories">AVD Test Categories</a> using the <code>skip_tests</code> flag</p>
<ol>
<li>Open the playbook <code>playbooks/validate.yml</code></li>
<li>
<p>Replace your <code>vars</code> section with the following</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="nt">use_anta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="nt">save_catalog</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="hll"><span class="w">    </span><span class="nt">eos_validate_state_md_report_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">eos_validate_state_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">fabric_name</span><span class="nv"> </span><span class="s">}}-no-harwdare.md&quot;</span><span class="w"> </span><span class="c1">#(1)!</span>
</span><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="hll"><span class="w">    </span><span class="nt">skip_tests</span><span class="p">:</span>
</span><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="hll"><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AvdTestHardware</span><span class="w"> </span><span class="c1">#(2)!</span>
</span></code></pre></div>
<ol>
<li>Save to a new unique report file</li>
<li>Skip the AVD hardware test category</li>
</ol>
</li>
<li>
<p>This will skip all hardware tests!</p>
</li>
</ol>
<h3 id="test-tags">Test Tags<a class="headerlink" href="#test-tags" title="Permanent link">&para;</a></h3>
<p>Let's take the opposite and there is a recent project that has just finished a large cabling exercise. Your project manager wants evidence the network team has signed off on all the cabling. Well good news, you can run specific tests using the tags!</p>
<p>We will actually just manipulate the way we run our validation playbook and add a tag at the end</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>ansible-playbook<span class="w"> </span>playbooks/validate.yml<span class="w"> </span>-i<span class="w"> </span>sites/site_1/inventory.yml<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;target_hosts=SITE1_FABRIC&quot;</span><span class="w"> </span>--tags<span class="w"> </span>lldp_topology
</code></pre></div>
<p>This will produce a report of the LLDP topology as understood by AVD!</p>
<div class="admonition success">
<p class="admonition-title">Great Success</p>
<p>Congratulations. You have now successfully completed the ANTA and AVD Network Testing without interacting with any switch CLI!</p>
</div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    2024-09-27
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Arista Networks
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs Insiders
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/aristanetworks/avd-workshops" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/AristaNetworks" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.arista.com" target="_blank" rel="noopener" title="www.arista.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.4c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.3c2.2 20.4 3.3 41.8 3.3 64m28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64m112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7m-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6M8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64m186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.7z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "content.code.annotate", "content.code.copy", "content.tooltips", "header.autohide", "navigation.top", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.c7c1ca2c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c4a99efa.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../stylesheets/tables.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>